<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.57.2"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Sharing light, even in death"><title>在小新 13 Pro 上安装 Linux Desktop 环境 - Indexyz Blog</title><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/spectre.css@0.5.8/dist/spectre.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=https://blog.indexyz.me/css/syntax.css><link rel=stylesheet href=https://blog.indexyz.me/sass/main.min.bfe6bc4bb48fe5e39fc1dcbd6f38413f8c6c9bfcbb5541281b9be860cf0c3d8b.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/disqusjs@1.2/dist/disqusjs.css><script src=https://cdn.jsdelivr.net/npm/disqusjs@1.1/dist/disqus.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-97074604-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-97074604-1');</script></head><body><header id=page-header><div class="container grid-lg"><a href=https://blog.indexyz.me/ class=title>Indexyz Blog</a><h2 class=description>Sharing light, even in death</h2><div><nav id=nav-menu role=navigation><a href=/>首页</a>
<a href=/friends/>友链</a></nav></div></div></header><main><div class="container grid-lg"><section id=posts class=post-single><article temscope itemtype=http://schema.org/Article><header><h1 class=post-title itemprop="name headline"><a href=https://blog.indexyz.me/archives/install-linux-in-xiaoxin/ itemprop=url>在小新 13 Pro 上安装 Linux Desktop 环境</a></h1><div class=post-meta-list><span class=post-meta><span>时间:</span>
<time datetime=2020-06-10T14:37:13&#43;0800>2020-06-10</time></span>
<span class=post-meta><span>分类:</span>
<a href=/categories/linux itemprop=url rel=index><span itemprop=name>Linux</span></a>
&nbsp;</span></span></div></header><div class=post-body itemprop=articleBody><p>最近在尝试有啥舒服的开发环境，将 Windows 更新到了 2004 之后启用 WSL 2 还是不能满足我的大部分需求，而 MacOS 对于某些开发工具支持有问题（说的就是你 Forge Gradle）。最后不如直接尝试一下开源 <del>拖拉机</del>, 直接在实体机上安装 Linux 作为日用系统。</p><p><img src=https://i.loli.net/2020/06/21/rkPuze9V6RLlJdy.jpg alt="System details"></p><p><del>AMD YES!</del></p><h2 id=安装-archlinux>安装 ArchLinux</h2><p>这一步非常简单，安装过多次 Arch 的话应该已经非常熟练了，这里采用的 UEFI 启动</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span><span class=c1># Root 目录在 /mnt, efi 文件夹挂载到 /mnt/boot</span>
<span class=ln>2</span>pacstrap /mnt base linux linux-firmware
<span class=ln>3</span>genfstab -U /mnt &gt;&gt; /mnt/etc/fstab</code></pre></div><p>然后 <code>arch-chroot /mnt</code> 到我们的新系统里并且执行</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span>pacman -S grub efibootmgr
<span class=ln>2</span>grub-install --target<span class=o>=</span>x86_64-efi --efi-directory<span class=o>=</span>/boot --bootloader-id<span class=o>=</span>grub
<span class=ln>3</span>grub-mkconfig -o /boot/grub/grub.cfg
<span class=ln>4</span>passwd <span class=c1># set root password</span></code></pre></div><p>重启就可以引导到硬盘上的 Arch 中了</p><h3 id=安装-kde>安装 KDE</h3><p>这里采用的 KDE 作为桌面环境 <del>我个人挺喜欢 KDE 的, GNOME 快滚</del>，根据 ArchLinux Wiki 上的<a href=https://wiki.archlinux.org/index.php/KDE>安装手册</a>，只需要</p><pre><code>pacman -S plasma kde-applications
systemctl enable sddm
</code></pre><p>然后重启就可以看到 SDDM 的登录界面了</p><h3 id=安装其他字体>安装其他字体</h3><p>为了在 Linux 下更好的显示大部分的字体, 我安装了 <a href=https://aur.archlinux.org/packages/ttf-ms-win10/>ttf-ms-win10 - aur</a> 这个包, 需要提取出 Windows 的字体然后安装</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span>7z e Win10_2004_Chinese<span class=se>\(</span>Simplified<span class=se>\)</span>_x64.iso sources/install.wim
<span class=ln>2</span>7z e install.wim <span class=m>1</span>/Windows/<span class=o>{</span>Fonts/<span class=s2>&#34;*&#34;</span>.<span class=o>{</span>ttf,ttc<span class=o>}</span>,System32/Licenses/neutral/<span class=s2>&#34;*&#34;</span>/<span class=s2>&#34;*&#34;</span>/license.rtf<span class=o>}</span> -ofonts/
<span class=ln>3</span><span class=nb>cd</span> fonts
<span class=ln>4</span>wget <span class=s1>&#39;https://aur.archlinux.org/cgit/aur.git/plain/PKGBUILD?h=ttf-ms-win10&#39;</span> -O PKGBUILD
<span class=ln>5</span>makepkg --skipchecksums
<span class=ln>6</span>sudo pacman -U *.tar.xz</code></pre></div><h2 id=适配-hidpi-屏幕>适配 HiDPI 屏幕</h2><h3 id=设定-kde-和-sddm-缩放>设定 KDE 和 SDDM 缩放</h3><p>在 KDE 中进入 System Settings -&gt; Display and Monitor 中可以设定缩放，我设定的值为 150% 缩放。</p><p><img src=https://i.loli.net/2020/06/10/1zfCoXTa8yJdUYu.png alt="Set glolbal scale"></p><p>然后去 Startup and Shutdown 的 Login Screen (SDDM) 下面的 Advanced 选项卡中，点击 Sync 来同步缩放设定到 SDDM 中</p><p><img src=https://i.loli.net/2020/06/10/ag5pcoxHsPhObut.png alt="Sync DPI with SDDM"></p><h3 id=调整-grub-字体大小>调整 GRUB 字体大小</h3><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span><span class=c1># pacman -S ttf-iosevka</span>
<span class=ln>2</span>grub-mkfont -s <span class=m>30</span> -o /boot/grub/fonts/unicode.pf2 /usr/share/fonts/ttf-iosevka/iosevka-regular.ttf</code></pre></div><p>可以将 <code>/usr/share/fonts/ttf-iosevka/iosevka-regular.ttf</code> 更换为你看着舒服的字体, 重启之后 GRUB 的字体就不是那么的难受了</p><h2 id=配置-ir-传感器进行人脸识别解锁>配置 IR 传感器进行人脸识别解锁</h2><p>这台机器上是有 IR 传感器的，在 Windows 下可以通过 Windows Hello 进行人脸识别快速解锁。</p><p>已经有现成的开源项目实现了 Linux 上的 Windows Hello style 人脸解锁: <a href=https://github.com/boltgolt/howdy>Howdy</a></p><p>一开始我发现 <code>/dev/video2</code> 是一个可以用的摄像头，但是因为没有发出红外光而读取不到任何信息，在 <a href=https://github.com/boltgolt/howdy/issues/269>Howdy #269</a> 上发现了如何去启用摄像头的 IR-LED</p><p>在终端中执行（执行后重启也有效果，只需要执行一次）</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span><span class=nb>cd</span> /tmp
<span class=ln>2</span>git clone https://github.com/PetePriority/chicony-ir-toggle.git
<span class=ln>3</span>gcc main.c -o chicony-ir-toggle
<span class=ln>4</span>./chicony-ir-toggle -d /dev/video2 on</code></pre></div><p>就可以在使用摄像头的时候启用 IR-RED <del>不知道联想为什么要这么做</del></p><p>记得调整 Howdy 的 <code>dark_threshold</code> 参数为一个合适的值，我个人使用的是 90，也可以调整的更大一些</p><p>等到 <code>howday test</code> 测试能识别到人脸并通过 <code>howdy add</code> 添加人脸之后, 我们需要配置 Linux 的 PAM 登录来达到人脸识别登录的效果</p><h2 id=启用蓝牙>启用蓝牙</h2><p>默认安装完是不会启用蓝牙的，需要手动启用 systemd 的服务才能使用蓝牙</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span>systemctl <span class=nb>enable</span> --now bluetooth</code></pre></div><p>启用之后 KDE 的托盘部分就会显示蓝牙图标了</p><p>为了使用蓝牙耳机，还需要安装 PulseAudio 的蓝牙模块</p><pre><code>pacman -S pulseaudio-bluetooth
pluseaudio -k
pactl load-module module-bluetooth-discover
</code></pre><h2 id=配置中文输入法>配置中文输入法</h2><p>作为一个中文为母语的人，当然要先配置中文输入法啦，在 KDE 上使用中文输入法也非常简单</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span>pacman -S fcitx fcitx-rime
<span class=ln>2</span>
<span class=ln>3</span>cat &gt; ~/.pam_environment <span class=s>&lt;&lt;EOF
</span><span class=ln>4</span><span class=s>GTK_IM_MODULE=fcitx
</span><span class=ln>5</span><span class=s>QT_IM_MODULE=fcitx
</span><span class=ln>6</span><span class=s>XMODIFIERS=@im=fcitx
</span><span class=ln>7</span><span class=s>EOF</span></code></pre></div><p>然后就可以重启后在 KDE 任务栏发现 fcitx 的图标了，区域切换到中文就可以添加 RIME 输入法了。RIME 在默认的主题中输入中文会有些问题，可以自己去找一个喜欢的主题（我现在在使用 <a href=https://github.com/hrko99/fcitx-skin-material>fcitx-skin-material</a>）</p><p><img src=https://i.loli.net/2020/06/10/qayKLB2RAdeIf3m.png alt="Fcitx Input"></p></div></article><ul class=pagination><li class="page-item page-prev"><a href=https://blog.indexyz.me/archives/install-wsl2/><div class=page-item-subtitle>上一篇</div><div class="page-item-title h5">WSL2 踩坑日记</div></a></li><li class="page-item page-next"><a href=https://blog.indexyz.me/archives/run-sspanel-uim-with-docker/><div class=page-item-subtitle>下一篇</div><div class="page-item-title h5">使用 Docker 快速的运行 SSPanel-UIM</div></a></li></ul><div id=disqus_thread></div><script>new DisqusJS(JSON.parse("{\"api\":\"https://disqus.skk.moe/disqus/\",\"apikey\":\"VtpQwhbhO3YTIYSZdx1N8vOJ6me3une1xSIeXhpuPcE4jurE17UlJozkc9qhvjDw\",\"shortname\":\"indexyz-blog\",\"sitename\":\"Indexyz Blog\"}"))</script></section></div></main><footer class=page-footer><p>Copyright © 2018-2020, Indexyz</p><p>Power by
<a href=https://gohugo.io/>Hugo</a> | Theme
<a href=https://github.com/Indexyz/hugo-theme-index/>Index</a></p></footer></body></html>