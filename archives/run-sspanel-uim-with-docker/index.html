<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.57.2"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Sharing light, even in death"><title>使用 Docker 快速的运行 SSPanel-UIM - Indexyz Blog</title><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/spectre.css@0.5.8/dist/spectre.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=https://blog.indexyz.me/css/syntax.css><link rel=stylesheet href=https://blog.indexyz.me/sass/main.min.bfe6bc4bb48fe5e39fc1dcbd6f38413f8c6c9bfcbb5541281b9be860cf0c3d8b.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/disqusjs@1.2/dist/disqusjs.css><script src=https://cdn.jsdelivr.net/npm/disqusjs@1.1/dist/disqus.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-97074604-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-97074604-1');</script></head><body><header id=page-header><div class="container grid-lg"><a href=https://blog.indexyz.me/ class=title>Indexyz Blog</a><h2 class=description>Sharing light, even in death</h2><div><nav id=nav-menu role=navigation><a href=/>首页</a>
<a href=/friends/>友链</a></nav></div></div></header><main><div class="container grid-lg"><section id=posts class=post-single><article temscope itemtype=http://schema.org/Article><header><h1 class=post-title itemprop="name headline"><a href=https://blog.indexyz.me/archives/run-sspanel-uim-with-docker/ itemprop=url>使用 Docker 快速的运行 SSPanel-UIM</a></h1><div class=post-meta-list><span class=post-meta><span>时间:</span>
<time datetime=2020-03-26T01:24:39&#43;0800>2020-03-26</time></span>
<span class=post-meta><span>分类:</span>
<a href=/categories/linux itemprop=url rel=index><span itemprop=name>Linux</span></a>
&nbsp;
<a href=/categories/docker itemprop=url rel=index><span itemprop=name>Docker</span></a>
&nbsp;</span></span></div></header><div class=post-body itemprop=articleBody><p>Docker is awesome!</p><h2 id=tl-dr>TL; DR</h2><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span>curl https://gist.github.com/Indexyz/d548520f2f742d9694140e162e76e3b0/raw/c8fce2c510340f10912fb1a86fc88ee8cbf22da0/install.sh <span class=p>|</span> bash</code></pre></div><script src=https://gist.github.com/Indexyz/d548520f2f742d9694140e162e76e3b0.js></script><p>然后访问 <a href=http://ip>http://ip</a> 就可以看到 SSPanel 了</p><h2 id=安装环境>安装环境</h2><p>以下使用 Debian 10 作为基础环境, 通过 Docker 官方的安装方式安装的 Docker</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span>curl -sSL get.docker.com <span class=p>|</span> bash
<span class=ln>2</span>systemctl <span class=nb>enable</span> --now docker</code></pre></div><h2 id=安装数据库>安装数据库</h2><p>使用了 MariaDB 作为数据库, 可以使用</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span><span class=nb>export</span> <span class=nv>DB_PASS</span><span class=o>=</span><span class=s2>&#34;P@55w0rD&#34;</span> <span class=c1># 数据库密码</span>
<span class=ln>2</span>docker volume create mariadb
<span class=ln>3</span>
<span class=ln>4</span>docker run <span class=se>\
</span><span class=ln>5</span><span class=se></span>    --name database -d <span class=se>\
</span><span class=ln>6</span><span class=se></span>    -e <span class=nv>MYSQL_ROOT_PASSWORD</span><span class=o>=</span><span class=nv>$DB_PASS</span> <span class=se>\
</span><span class=ln>7</span><span class=se></span>    -v mariadb:/var/lib/mysql <span class=se>\
</span><span class=ln>8</span><span class=se></span>    mariadb:10.5.1</code></pre></div><h3 id=恢复-sql-文件>恢复 SQL 文件</h3><p>下载 <code>glzlin_all.sql</code> 然后恢复到数据库中</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span>wget https://github.com/Anankke/SSPanel-Uim/raw/dev/sql/glzjin_all.sql
<span class=ln>2</span>
<span class=ln>3</span>docker <span class=nb>exec</span> -i database sh -c <span class=s1>&#39;exec mysql -uroot -p&#34;$MYSQL_ROOT_PASSWORD&#34;&#39;</span> <span class=s>&lt;&lt;EOF
</span><span class=ln>4</span><span class=s>CREATE DATABASE IF NOT EXISTS sspanel CHARACTER SET utf8 COLLATE utf8_general_ci;
</span><span class=ln>5</span><span class=s>EOF</span>
<span class=ln>6</span>
<span class=ln>7</span>docker <span class=nb>exec</span> -i database sh -c <span class=s1>&#39;exec mysql -uroot -p&#34;$MYSQL_ROOT_PASSWORD&#34; sspanel&#39;</span> &lt; glzjin_all.sql</code></pre></div><p>这样就完成了恢复</p><h3 id=安装-phpmyadmin-可选>安装 PHPMyAdmin (可选)</h3><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span>docker run --name phpmyadmin -d <span class=se>\
</span><span class=ln>2</span><span class=se></span>    -d --link database:db <span class=se>\
</span><span class=ln>3</span><span class=se></span>    -p <span class=m>8080</span>:80 <span class=se>\
</span><span class=ln>4</span><span class=se></span>    phpmyadmin/phpmyadmin</code></pre></div><p>可以自己将 <code>-p 8080:80</code> 中 8080 换为你需要的端口 默认运行在 :8080 上</p><p>访问 <a href=http://ip:8080>http://ip:8080</a> 就可以访问到 PMA 面板了</p><h2 id=安装面板>安装面板</h2><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln> 1</span>docker run --name sspanel -d <span class=se>\
</span><span class=ln> 2</span><span class=se></span>    --link database:db <span class=se>\
</span><span class=ln> 3</span><span class=se></span>    -e <span class=nv>UIM_ENV_REPLACE_ENABLE</span><span class=o>=</span><span class=m>1</span> <span class=se>\
</span><span class=ln> 4</span><span class=se></span>    -e <span class=nv>UIM_DB_HOST</span><span class=o>=</span>db <span class=se>\
</span><span class=ln> 5</span><span class=se></span>    -e <span class=nv>UIM_DB_DATABASE</span><span class=o>=</span>sspanel <span class=se>\
</span><span class=ln> 6</span><span class=se></span>    -e <span class=nv>UIM_DB_USERNAME</span><span class=o>=</span>root <span class=se>\
</span><span class=ln> 7</span><span class=se></span>    -e <span class=nv>UIM_DB_PASSWORD</span><span class=o>=</span><span class=nv>$DB_PASS</span> <span class=se>\
</span><span class=ln> 8</span><span class=se></span>    -p <span class=m>80</span>:80 <span class=se>\
</span><span class=ln> 9</span><span class=se></span>    sspaneluim/panel
<span class=ln>10</span>
<span class=ln>11</span>docker <span class=nb>exec</span> -i sspanel sh -c <span class=s1>&#39;php xcat initQQWry&#39;</span>
<span class=ln>12</span>docker <span class=nb>exec</span> -i sspanel sh -c <span class=s1>&#39;php xcat resetTraffic&#39;</span>
<span class=ln>13</span>docker <span class=nb>exec</span> -i sspanel sh -c <span class=s1>&#39;php xcat initdownload&#39;</span></code></pre></div><p>可以快速的运行一个可以使用的 SSPanel 实例</p><h3 id=修改-config>修改 Config</h3><p>查看 <a href=https://github.com/Anankke/SSPanel-Uim/blob/dev/config/.config.example.php>Example Config</a>, 看到要修改的 key 名称, 例如 <code>$_ENV['smtp_host']</code>, 将其大写后加入 <code>UIM_</code> 的 Prefix, 变为 <code>UIM_SMTP_HOST</code>, 设置这个环境变量为你需要的值</p><h3 id=创建-admin-账户>创建 Admin 账户</h3><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span>docker <span class=nb>exec</span> -i sspanel sh -c <span class=s1>&#39;php xcat createAdmin&#39;</span></code></pre></div><p>然后根据提示就可以创建完成 Admin 账户了, 访问 <a href=http://ip:80>http://ip:80</a> 即可看到面板</p><h3 id=建议修改的-config>建议修改的 Config</h3><ul><li><p><code>baseUrl (UIM_BASEURL)</code> - 站点地址</p></li><li><p><code>muKey (UIM_MUKEY)</code> - WEBAPI 校验 KEY</p></li><li><p><code>appName (UIM_APPNAME)</code> - 应用名称</p></li></ul><h3 id=修改其他文件>修改其他文件</h3><p>将文件 mount 到 /var/www 下面, 例如修改 /config/appprofile.php 这个文件, 只需要在启动参数中加入</p><div class=highlight><pre class=chroma><code class=language-text data-lang=text><span class=ln>1</span>-v /root/appprofile.php:/var/www/config/appprofile.php</code></pre></div><p>此处就使用宿主机器上的 /root/appprofile.php 替换掉了容器当中的 /config/appprofile.php 文件</p><h2 id=高级操作>高级操作</h2><h3 id=使用-nginx-作为前置代理>使用 Nginx 作为前置代理</h3><blockquote><p>TODO</p></blockquote></div></article><ul class=pagination><li class="page-item page-prev"><a href=https://blog.indexyz.me/archives/install-linux-in-xiaoxin/><div class=page-item-subtitle>上一篇</div><div class="page-item-title h5">在小新 13 Pro 上安装 Linux Desktop 环境</div></a></li><li class="page-item page-next"><a href=https://blog.indexyz.me/archives/netlify-cms-in-blog/><div class=page-item-subtitle>下一篇</div><div class="page-item-title h5">使用 Netlify CMS 作为博客的 CMS</div></a></li></ul><div id=disqus_thread></div><script>new DisqusJS(JSON.parse("{\"api\":\"https://disqus.skk.moe/disqus/\",\"apikey\":\"VtpQwhbhO3YTIYSZdx1N8vOJ6me3une1xSIeXhpuPcE4jurE17UlJozkc9qhvjDw\",\"shortname\":\"indexyz-blog\",\"sitename\":\"Indexyz Blog\"}"))</script></section></div></main><footer class=page-footer><p>Copyright © 2018-2020, Indexyz</p><p>Power by
<a href=https://gohugo.io/>Hugo</a> | Theme
<a href=https://github.com/Indexyz/hugo-theme-index/>Index</a></p></footer></body></html>