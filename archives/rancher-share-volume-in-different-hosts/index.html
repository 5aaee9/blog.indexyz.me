<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.57.2"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Sharing light, even in death"><title>Rancher 使用 NFS 在多个主机之间共享 Volume - Indexyz Blog</title><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/spectre.css@0.5.8/dist/spectre.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=https://blog.indexyz.me/css/syntax.css><link rel=stylesheet href=https://blog.indexyz.me/sass/main.min.bfe6bc4bb48fe5e39fc1dcbd6f38413f8c6c9bfcbb5541281b9be860cf0c3d8b.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/disqusjs@1.2/dist/disqusjs.css><script src=https://cdn.jsdelivr.net/npm/disqusjs@1.1/dist/disqus.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-97074604-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-97074604-1');</script></head><body><header id=page-header><div class="container grid-lg"><a href=https://blog.indexyz.me/ class=title>Indexyz Blog</a><h2 class=description>Sharing light, even in death</h2><div><nav id=nav-menu role=navigation><a href=/>首页</a>
<a href=/friends/>友链</a></nav></div></div></header><main><div class="container grid-lg"><section id=posts class=post-single><article temscope itemtype=http://schema.org/Article><header><h1 class=post-title itemprop="name headline"><a href=https://blog.indexyz.me/archives/rancher-share-volume-in-different-hosts/ itemprop=url>Rancher 使用 NFS 在多个主机之间共享 Volume</a></h1><div class=post-meta-list><span class=post-meta><span>时间:</span>
<time datetime=2018-12-31T00:45:00&#43;0800>2018-12-31</time></span>
<span class=post-meta><span>分类:</span>
<a href=/categories/rancher itemprop=url rel=index><span itemprop=name>Rancher</span></a>
&nbsp;</span></span></div></header><div class=post-body itemprop=articleBody><p><del>Rancher Is The BEST!</del></p><p>Rancher 大幅度减轻了我多机负载均衡的难度, 但是内建的 Volume 系统比较难配, 踩了不小的坑（</p><h1 id=安装-nfs>安装 NFS</h1><p>NFS 这玩意并不能使用用户名密码登陆, 这里我直接添加了一台 Host 然后创建了一个 service 在 apps 这个 stack 下面</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=ln> 1</span>version<span class=p>:</span><span class=w> </span><span class=s1>&#39;2&#39;</span><span class=w>
</span><span class=ln> 2</span><span class=w></span>services<span class=p>:</span><span class=w>
</span><span class=ln> 3</span><span class=w>  </span>nfs<span class=p>:</span><span class=w>
</span><span class=ln> 4</span><span class=w>    </span>privileged<span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=ln> 5</span><span class=w>    </span>image<span class=p>:</span><span class=w> </span>itsthenetwork/nfs-server-alpine<span class=p>:</span>latest<span class=w>
</span><span class=ln> 6</span><span class=w>    </span>environment<span class=p>:</span><span class=w>
</span><span class=ln> 7</span><span class=w>      </span>SHARED_DIRECTORY<span class=p>:</span><span class=w> </span>/nfsshare<span class=w>
</span><span class=ln> 8</span><span class=w>    </span>stdin_open<span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=ln> 9</span><span class=w>    </span>volumes<span class=p>:</span><span class=w>
</span><span class=ln>10</span><span class=w>    </span>-<span class=w> </span>/data/nfsshare<span class=p>:</span>/nfsshare<span class=w>
</span><span class=ln>11</span><span class=w>    </span>tty<span class=p>:</span><span class=w> </span><span class=kc>true</span></code></pre></div><h1 id=安装-nfs-volume-provider>安装 NFS Volume Provider</h1><p>在应用商店中找到并且部署 <code>Rancher NFS</code></p><p><img src=https://i.loli.net/2018/12/31/5c28f56751fa3.png alt="Rancher NFS"></p><p>点击 Deployed 并且使用 <code>serviceName.stackName</code> 作为地址
&gt; 此处使用 <code>nfs.apps</code></p><p>然后会在每个 node 上运行 nfs 的 client</p><h2 id=注意事项>注意事项</h2><h3 id=容器启动的时候-failre>容器启动的时候 failre</h3><p><code>Rancher NFS</code> 的实现依赖各个主机上的内核对 nfs 的实现, 在某些发行版上 (点名 Arch Linux) 会出现 <code>mount.nfs: No such device</code> 的情况</p><p>例如 Arch Linux, 执行 <code>pacman -S nfs-utils</code> 然后重启机器就可以解决这个问题</p></div></article><ul class=pagination><li class="page-item page-prev"><a href=https://blog.indexyz.me/archives/starting-using-k3s/><div class=page-item-subtitle>上一篇</div><div class="page-item-title h5">k3s 踩坑</div></a></li><li class="page-item page-next"><a href=https://blog.indexyz.me/archives/recv-and-send-sms-in-raspberry-pi/><div class=page-item-subtitle>下一篇</div><div class="page-item-title h5">使用树莓派来收发短信</div></a></li></ul><div id=disqus_thread></div><script>new DisqusJS(JSON.parse("{\"api\":\"https://disqus.skk.moe/disqus/\",\"apikey\":\"VtpQwhbhO3YTIYSZdx1N8vOJ6me3une1xSIeXhpuPcE4jurE17UlJozkc9qhvjDw\",\"shortname\":\"indexyz-blog\",\"sitename\":\"Indexyz Blog\"}"))</script></section></div></main><footer class=page-footer><p>Copyright © 2018-2020, Indexyz</p><p>Power by
<a href=https://gohugo.io/>Hugo</a> | Theme
<a href=https://github.com/Indexyz/hugo-theme-index/>Index</a></p></footer></body></html>