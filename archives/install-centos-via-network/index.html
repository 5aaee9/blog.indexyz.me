<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.57.2"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Sharing light, even in death"><title>网络重装 CentOS - Indexyz Blog</title><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/spectre.css@0.5.8/dist/spectre.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=https://blog.indexyz.me/css/syntax.css><link rel=stylesheet href=https://blog.indexyz.me/sass/main.min.bfe6bc4bb48fe5e39fc1dcbd6f38413f8c6c9bfcbb5541281b9be860cf0c3d8b.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/disqusjs@1.2/dist/disqusjs.css><script src=https://cdn.jsdelivr.net/npm/disqusjs@1.1/dist/disqus.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-97074604-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-97074604-1');</script></head><body><header id=page-header><div class="container grid-lg"><a href=https://blog.indexyz.me/ class=title>Indexyz Blog</a><h2 class=description>Sharing light, even in death</h2><div><nav id=nav-menu role=navigation><a href=/>首页</a>
<a href=/friends/>友链</a></nav></div></div></header><main><div class="container grid-lg"><section id=posts class=post-single><article temscope itemtype=http://schema.org/Article><header><h1 class=post-title itemprop="name headline"><a href=https://blog.indexyz.me/archives/install-centos-via-network/ itemprop=url>网络重装 CentOS</a></h1><div class=post-meta-list><span class=post-meta><span>时间:</span>
<time datetime=2018-03-24T23:21:11Z>2018-03-24</time></span>
<span class=post-meta><span>分类:</span>
<a href=/categories/linux itemprop=url rel=index><span itemprop=name>Linux</span></a>
&nbsp;</span></span></div></header><div class=post-body itemprop=articleBody><p><code>Debian</code> 系的系统的网络重装脚本已经很多了 比如 <a href=https://moeclub.org/2017/03/25/82/>这个脚本</a></p><p>但是 <code>RedHat</code> 系列的系统却机没有网络安装脚本, 当需要调整分区或者是安装一个纯净的系统的时候就遇到了困难</p><p>但是 <code>RedHat</code> 系的系统也是可以从网络重装的 下面就介绍一种网络重装的方法</p><p>本文主体部分主要是重装 CentOS 6, 会在最后列出重装 <code>CentOS 7</code> 和 <code>CentOS 6</code> 的区别</p><h1 id=centos-6-grub-1>CentOS 6 (GRUB 1)</h1><p>首先 先获取机器的 IP地址，网关地址以及子网掩码</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span>ip route <span class=p>|</span> grep default <span class=c1># 获取网关地址</span>
<span class=ln>2</span>ip a s eth0             <span class=c1># 获取 IP 地址 和 子网大小</span></code></pre></div><p>然后下载 <code>vmlinuz</code> 和 <code>initrd.img</code> 到 <code>/boot</code></p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span><span class=nb>cd</span> /boot
<span class=ln>2</span>wget http://mirror.centos.org/centos/6/os/x86_64/isolinux/vmlinuz
<span class=ln>3</span>wget http://mirror.centos.org/centos/6/os/x86_64/isolinux/initrd.img</code></pre></div><p>编辑 <code>/etc/grub.conf</code> 在第一个 <code>title</code>标签 前面加入</p><pre><code>title net
    root (hd0,0)
    kernel /boot/vmlinuz vnc vncpassword=12345678 headless ip=IPADDRES netmask=NETMASK gateway=GATEWAY dns=8.8.8.8 ksdevice=eth0 method=http://mirror.centos.org/centos/6/os/x86_64/ lang=en_US keymap=us
    initrd /boot/initrd.img
</code></pre><blockquote><p>注意 <code>root (hd0,0)</code> 的内容可能有所不同 比如在 OVH 独服 上是 <code>root (hd0,1)</code>具体按照下面那个 <code>title</code> 中的 <code>root</code>位置</p><p>请将上面的 <code>IPADDRES</code>, <code>GATEWAY</code>, <code>NETMASK</code> 分别换成你机器的 IP 地址, 网关地址, 子网掩码</p></blockquote><p>然后重启就可以通过 <code>IP地址:1</code> 的端口来连接到 VNC 进行全新安装模式了</p><h1 id=centos-7-grub2>CentOS 7 (GRUB2)</h1><p>首先 先获取机器的 IP地址，网关地址以及子网掩码</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span>ip route <span class=p>|</span> grep default <span class=c1># 获取网关地址</span>
<span class=ln>2</span>ip a s eth0             <span class=c1># 获取 IP 地址 和 子网大小</span></code></pre></div><p>然后下载 <code>vmlinuz</code> 和 <code>initrd.img</code> 到 <code>/boot</code></p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span><span class=nb>cd</span> /boot
<span class=ln>2</span>wget http://mirror.centos.org/centos/6/os/x86_64/isolinux/vmlinuz
<span class=ln>3</span>wget http://mirror.centos.org/centos/6/os/x86_64/isolinux/initrd.img</code></pre></div><p>然后使用如下指令来获取硬盘分区的 UUID</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span>cat /etc/grub2.cfg <span class=p>|</span> grep search <span class=p>|</span> grep <span class=nv>set</span><span class=o>=</span>root</code></pre></div><p>将会有以下的输出</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span>search --no-floppy --fs-uuid --set<span class=o>=</span>root 8c1015ef-fed5-4e77-bca0-478070c89df7</code></pre></div><p>这里的 <code>8c1015ef-fed5-4e77-bca0-478070c89df7</code> 就是磁盘分区的 UUID</p><p>接下来修改 <code>/etc/grub.d/40_custom</code> 在文件末尾加入</p><pre><code>menuentry 'net' {
  load_video
  set gfxpayload=keep
  insmod gzio
  insmod part_msdos
  insmod ext2
  set root='hd0,msdos1'
  if [ x$feature_platform_search_hint = xy ]; then
    search --no-floppy --fs-uuid --set=root --hint='hd0,msdos1' PARTUUID
  else
    search --no-floppy --fs-uuid --set=root PARTUUID
  fi
  linux16 /vmlinuz inst.vnc inst.vncpassword=12345678 inst.headless ip=IPADDRES::GATEWAY:NETMASK::eth0:none nameserver=8.8.8.8 inst.repo=http://mirror.centos.org/centos/6/os/x86_64/ inst.lang=en_US inst.keymap=us
  initrd16 /initrd.img
}
</code></pre><blockquote><p>请将上面的 <code>PARTUUID</code>, <code>IPADDRES</code>, <code>GATEWAY</code>, <code>NETMASK</code> 分别换成你机器的 分区 UUID, IP 地址, 网关地址, 子网掩码</p></blockquote><p>接下来使用以下命令来重新生成 grub 引导文件以及在下次启动的时候进入网络安装模式</p><pre><code>grub2-mkconfig -o /boot/grub2/grub.cfg
grub2-reboot net
</code></pre><p>然后重启就可以通过 <code>IP地址:1</code> 的端口来连接到 VNC 进行全新安装模式了</p><h1 id=常见问题>常见问题</h1><h2 id=我在修改-grub-的时候该怎么填-initrd-img-和-vmlinuz-的地址>我在修改 grub 的时候该怎么填 <code>initrd.img</code> 和 <code>vmlinuz</code> 的地址</h2><p>首先 查看是否有挂载在 <code>/boot</code> 下的分区</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span>df -h <span class=p>|</span> grep /boot</code></pre></div><p>如果有返回则代表应该直接以 <code>/initrd.img</code> 开头 如果没有的话以 <code>/boot/initrd.img</code> 开头</p><h2 id=centos-7-和-centos-6-在写参数时的不同>CentOS 7 和 CentOS 6 在写参数时的不同</h2><p>CentOS 7 的 格式如下</p><pre><code>/boot/vmlinuz inst.vnc inst.vncpassword=12345678 inst.headless ip=IPADDRES::GATEWAY:NATMASK::eth0:none nameserver=8.8.8.8 inst.repo=http://mirror.centos.org/centos/7.4.1708/os/x86_64/ inst.lang=en_US
</code></pre><p>而 CentOS 6 的格式如下</p><pre><code>/boot/vmlinuz vnc vncpassword=12345678 headless ip=IPADDRES netmask=NETMASK gateway=GATEWAY dns=8.8.8.8 ksdevice=eth0 method=http://mirror.centos.org/centos/6/os/x86_64/ lang=en_US keymap=us
</code></pre><h2 id=vnc-的默认密码是啥-如何修改>VNC 的默认密码是啥 如何修改</h2><p><code>vnc</code> 的密码是在 <code>vmlinuz</code> 那段定义的 在上面的几段配置文件中都为 <code>12345678</code></p><p>可以通过 修改 <code>vncpassword</code>和 <code>inst.vncpassword</code> 的方式来修改密码</p><blockquote><p>密码必须长于 8 位</p></blockquote></div></article><ul class=pagination><li class="page-item page-prev"><a href=https://blog.indexyz.me/archives/2018-steam-summer/><div class=page-item-subtitle>上一篇</div><div class="page-item-title h5">2018 年 Steam 暑期打折</div></a></li><li class="page-item page-next"><a href=https://blog.indexyz.me/archives/automatic-deploy-rancher/><div class=page-item-subtitle>下一篇</div><div class="page-item-title h5">自动更新 Rancher 上的应用</div></a></li></ul><div id=disqus_thread></div><script>new DisqusJS(JSON.parse("{\"api\":\"https://disqus.skk.moe/disqus/\",\"apikey\":\"VtpQwhbhO3YTIYSZdx1N8vOJ6me3une1xSIeXhpuPcE4jurE17UlJozkc9qhvjDw\",\"shortname\":\"indexyz-blog\",\"sitename\":\"Indexyz Blog\"}"))</script></section></div></main><footer class=page-footer><p>Copyright © 2018-2020, Indexyz</p><p>Power by
<a href=https://gohugo.io/>Hugo</a> | Theme
<a href=https://github.com/Indexyz/hugo-theme-index/>Index</a></p></footer></body></html>